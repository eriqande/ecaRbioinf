<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="description" content="This is pretty simple, but it is a standard operation,
and a hassle to hand code over and over again (especially
getting the lines that show the positions of the markers)."><title>make a raster plot of allelic types on haplotypes — haplo_raster_plot • ecaRbioinf</title><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.1.3/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.1.3/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- bootstrap-toc --><script src="https://cdn.rawgit.com/afeld/bootstrap-toc/v1.0.1/dist/bootstrap-toc.min.js"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="make a raster plot of allelic types on haplotypes — haplo_raster_plot"><meta property="og:description" content="This is pretty simple, but it is a standard operation,
and a hassle to hand code over and over again (especially
getting the lines that show the positions of the markers)."><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">ecaRbioinf</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.1.0.999</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="active nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
      </ul><form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off"></form>

      <ul class="navbar-nav"></ul></div>

    
  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>make a raster plot of allelic types on haplotypes</h1>
      
      <div class="d-none name"><code>haplo_raster_plot.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>This is pretty simple, but it is a standard operation,
and a hassle to hand code over and over again (especially
getting the lines that show the positions of the markers).</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">haplo_raster_plot</span><span class="op">(</span><span class="va">D</span>, h_ord <span class="op">=</span> <span class="cn">NULL</span>, <span class="va">pos_annot</span>, <span class="va">fcolors</span>,</span>
<span>  highlight_pos <span class="op">=</span> <span class="cn">NULL</span>, kinky_highlight_pos <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  kinky_highlight_color <span class="op">=</span> <span class="st">"red"</span>, yaxis_name <span class="op">=</span> <span class="st">"Haplotype"</span>,</span>
<span>  xaxis_name <span class="op">=</span> <span class="st">"SNP"</span>, pos_bar_height <span class="op">=</span> <span class="fl">0.1</span>, pos_bar_text_size <span class="op">=</span> <span class="fl">1</span>,</span>
<span>  lo_kink_frac <span class="op">=</span> <span class="fl">0.2</span>, hi_kink_frac <span class="op">=</span> <span class="fl">0.2</span>, tick_frac <span class="op">=</span> <span class="fl">0.1</span>,</span>
<span>  expand_top <span class="op">=</span> <span class="fl">0.1</span>, expand_width <span class="op">=</span> <span class="fl">0</span>, kinky_line_size <span class="op">=</span> <span class="fl">0.1</span>,</span>
<span>  het_outline_color <span class="op">=</span> <span class="cn">NA</span>, het_outline_size <span class="op">=</span> <span class="fl">1</span>,</span>
<span>  plot_read_depths <span class="op">=</span> <span class="cn">FALSE</span>, annotation_columns <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  annotation_rows <span class="op">=</span> <span class="cn">NULL</span>, anno_row_start <span class="op">=</span> <span class="fl">0</span>,</span>
<span>  snp_quant_tibble <span class="op">=</span> <span class="cn">NULL</span>, sq_props <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>lo <span class="op">=</span> <span class="op">-</span><span class="fl">9</span>, hi <span class="op">=</span> <span class="op">-</span><span class="fl">1</span><span class="op">)</span>,</span>
<span>  no_legend <span class="op">=</span> <span class="cn">FALSE</span>, no_y_labels <span class="op">=</span> <span class="cn">FALSE</span>, no_x_labels <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>
    <dl><dt>D</dt>
<dd><p>a tibble with a column <code>POS</code> that is the positions of the
markers, a column <code>hnames</code> which are the names of the haplotypes, and
a column <code>atypes</code> which are the types to be plotted as different colors.
It might also have a column <code>maxGP</code> which holds the genotype probability
of the called allele.</p></dd>


<dt>h_ord</dt>
<dd><p>if not NULL (the default) this is a vecdtor giving the
order (from top to bottom of
the plot) that you want these to come out.  This will also filter the data set
to include only the hnames in h_ord.  If this is NULL, then the order
of haplotypes in the data set will be used.</p></dd>


<dt>pos_annot</dt>
<dd><p>a tibble with two columns: pname and pos that give the name of the
label you want on the genome position bar, and the position you want it at.</p></dd>


<dt>fcolors</dt>
<dd><p>a named vector to be passed as the values argument to scale_fill_manual. Note that
if you are including more categories in annotation_columns, then you have to include
them, too, for example: fcolors &lt;- c(S = "yellow", F = "blue", spring = "yellow", fall = "blue", Sacto = "red", Klamath = "green")</p></dd>


<dt>highlight_pos</dt>
<dd><p>a tibble with a column named "POS" of SNP positions and column named "name"
which holds the name for SNPs that should be highlighted by surrounding
the columns by a dotted line.</p></dd>


<dt>kinky_highlight_pos</dt>
<dd><p>just like highlight_pos, but operates separately to color
the kinky lines for highlighted positions that overlap with the columns.</p></dd>


<dt>kinky_highlight_color</dt>
<dd><p>By default this is red.</p></dd>


<dt>pos_bar_height</dt>
<dd><p>what fraction of the vertical plot area should we find the position
line above the plot area?</p></dd>


<dt>tick_frac</dt>
<dd><p>the fraction of pos_bar_height that will be half the tick mark height.</p></dd>


<dt>expand_top</dt>
<dd><p>the fraction of pos_bar_height to expand the top of the figure so
that it can capture the text of the positions.</p></dd>


<dt>expand_width</dt>
<dd><p>the fraction of the width of plot to expand by so that it can
capture the text of the positions.</p></dd>


<dt>het_outline_color</dt>
<dd><p>if this is not NA, it is the color which will
be used on the outside of each cell to denote whether it is heterozygous
or not.</p></dd>


<dt>plot_read_depths</dt>
<dd><p>If this is true, this just plots a heat map
identical to the raster haplo that shows read depths.</p></dd>


<dt>annotation_columns</dt>
<dd><p>this is a tibble that has the columns hnames,
column, value, width, and order.  These can be used to show different
characteristics in the negative x range.</p></dd>


<dt>annotation_rows</dt>
<dd><p>this is a tibble that has the columns POS,
row, value, height, and order.  These can be used to show different
characteristics in the negative y range.</p></dd>


<dt>anno_row_start</dt>
<dd><p>which row below the main raster do you want the annotation rows to start?</p></dd>


<dt>kink_frac</dt>
<dd><p>the fraction of the pos_bar_height at which the marker lines should kink.</p></dd>

</dl></div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">RoSA</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">rosa_9</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">D</span> <span class="op">&lt;-</span> <span class="va">RoSA</span> <span class="op"><a href="pipe.html">%&gt;%</a></span></span></span>
<span class="r-in"><span>     <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>hnames <span class="op">=</span> <span class="va">haplo_name</span>,</span></span>
<span class="r-in"><span>                   atypes <span class="op">=</span> <span class="va">alle2</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># make a tibble to annotate</span></span></span>
<span class="r-in"><span><span class="va">pos_annot</span> <span class="op">&lt;-</span> <span class="fu">tibble</span><span class="fu">::</span><span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html" class="external-link">tibble</a></span><span class="op">(</span>pos <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">12.1e6</span>, <span class="fl">12.35e6</span>, by <span class="op">=</span> <span class="fl">0.5e5</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="pipe.html">%&gt;%</a></span></span></span>
<span class="r-in"><span>     <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>pname <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sprintf.html" class="external-link">sprintf</a></span><span class="op">(</span><span class="st">"%.2f"</span>, <span class="va">pos</span><span class="op">/</span><span class="fl">1e06</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># it turns out that these guys are ordered in RoSA how we want them to come out</span></span></span>
<span class="r-in"><span><span class="va">h_ord</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">D</span><span class="op">$</span><span class="va">hnames</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># color the "spring" allele yellow and the other blue</span></span></span>
<span class="r-in"><span><span class="va">fcolors</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>S <span class="op">=</span> <span class="st">"yellow"</span>, F <span class="op">=</span> <span class="st">"blue"</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># get positions of SNPs to highlight</span></span></span>
<span class="r-in"><span><span class="va">h_pos</span> <span class="op">=</span> <span class="va">rosa_9</span> <span class="op"><a href="pipe.html">%&gt;%</a></span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">name</span>, <span class="va">POS</span><span class="op">)</span> <span class="op"><a href="pipe.html">%&gt;%</a></span></span></span>
<span class="r-in"><span>     <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>POS <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/integer.html" class="external-link">as.integer</a></span><span class="op">(</span><span class="va">POS</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">g</span> <span class="op">&lt;-</span> <span class="fu">haplo_raster_plot</span><span class="op">(</span><span class="va">D</span>, <span class="va">h_ord</span>, <span class="va">pos_annot</span>, <span class="va">fcolors</span>, <span class="va">h_pos</span><span class="op">)</span></span></span>
<span class="r-err co"><span class="r-pr">#&gt;</span> <span class="error">Error in geom_tile(data = D2, aes(x = POSfact, y = Hfact, fill = atypes,     colour = atypes)):</span> could not find function "geom_tile"</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># if you want to express genotype posteriors by transparency</span></span></span>
<span class="r-in"><span><span class="co"># you have to get those data from the unphased but imputed data</span></span></span>
<span class="r-in"><span><span class="va">U</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span>package <span class="op">=</span> <span class="st">"ecaRbioinf"</span>, <span class="st">"extdata"</span>, <span class="st">"greb1l-imputed-unphased.vcf.gz"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">u</span> <span class="op">&lt;-</span> <span class="fu">vcfR</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/vcfR/man/io_vcfR.html" class="external-link">read.vcfR</a></span><span class="op">(</span><span class="va">U</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Scanning file to determine attributes.</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> File attributes:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   meta lines: 10</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   header_line: 11</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   variant count: 5732</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   column count: 137</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Meta line 10 read in.</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> All meta lines processed.</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> gt matrix initialized.</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Character matrix gt created.</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   Character matrix gt rows: 5732</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   Character matrix gt cols: 137</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   skip: 0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   nrows: 5732</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   row_num: 0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Processed variant 1000Processed variant 2000Processed variant 3000Processed variant 4000Processed variant 5000Processed variant: 5732</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> All variants processed</span>
<span class="r-in"><span><span class="va">ut</span> <span class="op">&lt;-</span> <span class="fu">vcfR</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/vcfR/man/vcfR_to_tidy_conversion.html" class="external-link">vcfR2tidy</a></span><span class="op">(</span><span class="va">u</span><span class="op">)</span><span class="op">$</span><span class="va">gt</span> <span class="op"><a href="pipe.html">%&gt;%</a></span></span></span>
<span class="r-in"><span>     <span class="fu">tidyr</span><span class="fu">::</span><span class="fu"><a href="https://tidyr.tidyverse.org/reference/separate.html" class="external-link">separate</a></span><span class="op">(</span><span class="va">gt_GP</span>, into <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"gp0"</span>, <span class="st">"gp1"</span>, <span class="st">"gp2"</span><span class="op">)</span>, sep <span class="op">=</span> <span class="st">","</span>, convert <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Extracting gt element GT</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Extracting gt element DS</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Extracting gt element GP</span>
<span class="r-in"><span><span class="va">utj</span> <span class="op">&lt;-</span> <span class="va">ut</span> <span class="op"><a href="pipe.html">%&gt;%</a></span></span></span>
<span class="r-in"><span>     <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>maxGP <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">pmax</a></span><span class="op">(</span><span class="va">gp0</span>, <span class="va">gp1</span>, <span class="va">gp2</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="pipe.html">%&gt;%</a></span></span></span>
<span class="r-in"><span>     <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">POS</span>, <span class="va">Indiv</span>, <span class="va">maxGP</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">D_GP</span> <span class="op">&lt;-</span> <span class="va">D</span> <span class="op"><a href="pipe.html">%&gt;%</a></span></span></span>
<span class="r-in"><span>     <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html" class="external-link">left_join</a></span><span class="op">(</span><span class="va">utj</span>, by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"POS"</span>, <span class="st">"Indiv"</span><span class="op">)</span><span class="op">)</span></span></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p></p><p>Developed by Eric C. Anderson.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.6.</p>
</div>

    </footer></div>

  

  

  </body></html>

